{{ define "main" }}
<div id="feed-reader"></div>

<style>
    /* 整个容器的样式，使用 Flexbox 布局 */
    #feed-reader {
        display: flex;
        flex-direction: column;
        gap: 1em;
        /* 设置卡片之间的垂直间距 */
    }

    /* 单个状态卡片的样式 */
    .status-card {
        background-color: var(--card-background);
        border-radius: 10px;
        padding: 1.5em;
        box-shadow: 0 4px 6px var(--shadow-l2);
        transition: transform 0.2s ease-in-out;
        /* 添加 hover 动画 */
    }

    /* 鼠标悬停时的效果 */
    .status-card:hover {
        transform: translateY(-5px);
        /* 向上轻微移动 */
    }

    /* 标题和时间容器的样式 */
    .status-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 0.5em;
    }

    /* 标题样式 */
    .mumble-title {
        font-weight: bold;
        font-size: 1.1em;
        color: var(--accent-color);
    }

    /* 时间样式 */
    .mumble-time {
        font-size: 0.9em;
        color: #888;
    }

    /* 内容样式 */
    .status-content {
        line-height: 1.6;
        color: var(--body-text-color);
        /* 确保内容正确换行 */
        word-break: break-word;
        white-space: pre-wrap;
    }

    /* 底部链接样式 */
    .more-link {
        text-align: center;
        margin-top: 1.5em;
    }

    .more-link a {
        color: #6282ab;
        /* 蓝色链接 */
        text-decoration: none;
        /* 去掉下划线 */
        font-weight: bold;
    }

    .more-link a:hover {
        text-decoration: underline;
        /* 鼠标悬停时显示下划线 */
    }
</style>

<script>
    const feedURL = 'https://status.cafe/users/miya.atom';

    fetch(feedURL)
        .then(response => response.text())
        .then(str => {
            const parser = new window.DOMParser();
            const data = parser.parseFromString(str, "text/xml");
            const entries = data.querySelectorAll("entry");
            let html = "";

            // 时间格式化函数
            function timeAgo(publishedDate) {
                const now = new Date();
                const published = new Date(publishedDate);
                const diffInSeconds = Math.floor((now - published) / 1000);

                const secondsInMinute = 60;
                const secondsInHour = 60 * secondsInMinute;
                const secondsInDay = 24 * secondsInHour;

                if (diffInSeconds < secondsInMinute) {
                    return diffInSeconds + " seconds ago";
                } else if (diffInSeconds < secondsInHour) {
                    const minutes = Math.floor(diffInSeconds / secondsInMinute);
                    return minutes + " minute" + (minutes > 1 ? "s" : "") + " ago";
                } else if (diffInSeconds < secondsInDay) {
                    const hours = Math.floor(diffInSeconds / secondsInHour);
                    return hours + " hour" + (hours > 1 ? "s" : "") + " ago";
                } else {
                    const days = Math.floor(diffInSeconds / secondsInDay);
                    return days + " day" + (days > 1 ? "s" : "") + " ago";
                }
            }

            // 限制最多显示 15 条
            for (let i = 0; i < Math.min(entries.length, 15); i++) {
                const el = entries[i];
                const rawtitle = el.querySelector("title").textContent.trim();
                let emojiMatch = rawtitle.match(/[\p{Emoji}]/gu);
                emoji = emojiMatch ? emojiMatch.join('').replace(/[0-9]+$/, '') : '';
                const content = el.querySelector("content").textContent.trim();
                const publishedDate = el.querySelector("published").textContent;
                const timeAgoText = timeAgo(publishedDate);

                html += `
            <div class="status-card">
              <div class="status-header">
                <span class="mumble-title">Miya ${emoji || "Untitled"}</span>
                <span class="mumble-time">${timeAgoText}</span>
              </div>
              <div class="status-content">${content}</div>
            </div>`;
            }

            // 底部“更多”按钮
            html += `<p class="more-link">
                     <a href="https://status.cafe/users/miya" target="_blank">查看更多</a>
                   </p>`;

            document.getElementById("feed-reader").innerHTML = html;
        })
        .catch(error => {
            console.error('Error fetching or parsing data:', error);
        });
</script>
{{ end }}